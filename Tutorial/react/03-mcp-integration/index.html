
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A lightweight Python framework for building intelligent agents and multi-agent workflows.">
      
      
      
        <link rel="canonical" href="https://iamsdt.github.io/pyagenity/Tutorial/react/03-mcp-integration/">
      
      
        <link rel="prev" href="../02-dependency-injection/">
      
      
        <link rel="next" href="../04-streaming/">
      
      
      <link rel="icon" href="../../../None">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>React Agents with Model Context Protocol (MCP) - PyAgenity</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.e53b48f4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#react-agents-with-model-context-protocol-mcp" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="PyAgenity" class="md-header__button md-logo" aria-label="PyAgenity" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PyAgenity
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              React Agents with Model Context Protocol (MCP)
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Iamsdt/PyAgenity" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Iamsdt/PyAgenity
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  PyAgenity

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../Concept/" class="md-tabs__link">
        
  
  
    
  
  Concept

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="../../" class="md-tabs__link">
        
  
  
    
  
  Tutorial

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../reference/" class="md-tabs__link">
        
  
  
    
  
  Reference

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="PyAgenity" class="md-nav__button md-logo" aria-label="PyAgenity" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    PyAgenity
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Iamsdt/PyAgenity" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Iamsdt/PyAgenity
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PyAgenity
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../Concept/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Concept
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Concept
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Concept/Callbacks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Callbacks: Interception and Flow Control
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Concept/Command/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Commands: Combining State Updates with Control Flow
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Concept/Threadname/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Threadname
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Concept/dependency-injection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dependency Injection in PyAgenity
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Concept/id_generator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Id generator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Concept/publisher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Publisher: Real-time Agent Observability
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Concept/response_converter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Response converter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../Concept/context/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Context
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            Context
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Concept/context/checkpointer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Checkpointer: The Agent's Session Memory
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Concept/context/message/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Messages: The Lifeblood of Agent Communication
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Concept/context/state/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Agent State: The Mind of Your Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Concept/context/store/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Store: The Agent's Knowledge Memory
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../Concept/graph/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Graph
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_9" id="__nav_2_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_9">
            <span class="md-nav__icon md-icon"></span>
            Graph
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Concept/graph/Config/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Graph Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Concept/graph/advanced/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Advanced Patterns &amp; Performance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Concept/graph/control_flow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Control Flow &amp; Edges
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Concept/graph/execution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Execution &amp; Streaming Runtime
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Concept/graph/human-in-the-loop/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Human-in-the-Loop (HITL) &amp; Interrupts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Concept/graph/nodes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Nodes &amp; Return Types
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Concept/graph/tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tools &amp; Integrations
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Tutorial
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorial
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../long_term_memory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Long-Term Memory with Mem0
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../plan_act_reflect/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Plan-Act-Reflect Pattern
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../qdrant_store/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    QdrantStore Documentation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RAG (Retrieval-Augmented Generation) with PyAgenity
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    React
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            React
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../01-basic-react/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic React Patterns
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-dependency-injection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    React Agents with Dependency Injection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    React Agents with Model Context Protocol (MCP)
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    React Agents with Model Context Protocol (MCP)
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-objectives" class="md-nav__link">
    <span class="md-ellipsis">
      🎯 Learning Objectives
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-model-context-protocol" class="md-nav__link">
    <span class="md-ellipsis">
      🌐 Understanding Model Context Protocol
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🌐 Understanding Model Context Protocol">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-mcp" class="md-nav__link">
    <span class="md-ellipsis">
      What is MCP?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mcp-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      MCP Architecture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#benefits-of-mcp-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Benefits of MCP Integration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mcp-components-in-pyagenity" class="md-nav__link">
    <span class="md-ellipsis">
      🏗️ MCP Components in PyAgenity
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🏗️ MCP Components in PyAgenity">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-mcp-client-setup" class="md-nav__link">
    <span class="md-ellipsis">
      1. MCP Client Setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-toolnode-with-mcp-integration" class="md-nav__link">
    <span class="md-ellipsis">
      2. ToolNode with MCP Integration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-mcp-enabled-react-agent" class="md-nav__link">
    <span class="md-ellipsis">
      3. MCP-Enabled React Agent
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-example-weather-agent-with-mcp" class="md-nav__link">
    <span class="md-ellipsis">
      🌤️ Complete Example: Weather Agent with MCP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🌤️ Complete Example: Weather Agent with MCP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-create-mcp-server" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Create MCP Server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-create-mcp-client-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Create MCP Client Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-build-mcp-enabled-react-agent" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Build MCP-Enabled React Agent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-run-the-mcp-agent" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4: Run the MCP Agent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-running-the-complete-system" class="md-nav__link">
    <span class="md-ellipsis">
      Step 5: Running the Complete System
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-mcp-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      🔧 Advanced MCP Patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔧 Advanced MCP Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#multi-server-mcp-client" class="md-nav__link">
    <span class="md-ellipsis">
      Multi-Server MCP Client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mcp-tool-discovery-and-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      MCP Tool Discovery and Filtering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-handling-for-mcp-connections" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling for MCP Connections
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-custom-mcp-servers" class="md-nav__link">
    <span class="md-ellipsis">
      🏗️ Building Custom MCP Servers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🏗️ Building Custom MCP Servers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-mcp-server" class="md-nav__link">
    <span class="md-ellipsis">
      Database MCP Server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-system-mcp-server" class="md-nav__link">
    <span class="md-ellipsis">
      File System MCP Server
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debugging-mcp-integration" class="md-nav__link">
    <span class="md-ellipsis">
      🐛 Debugging MCP Integration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🐛 Debugging MCP Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mcp-connection-testing" class="md-nav__link">
    <span class="md-ellipsis">
      MCP Connection Testing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mcp-tool-introspection" class="md-nav__link">
    <span class="md-ellipsis">
      MCP Tool Introspection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mcp-performance-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      MCP Performance Monitoring
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#production-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      ⚡ Production Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="⚡ Production Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-mcp-server-health-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      1. MCP Server Health Monitoring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-mcp-tool-caching" class="md-nav__link">
    <span class="md-ellipsis">
      2. MCP Tool Caching
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-graceful-mcp-failover" class="md-nav__link">
    <span class="md-ellipsis">
      3. Graceful MCP Failover
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      🚀 Next Steps
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🚀 Next Steps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#advanced-mcp-topics" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced MCP Topics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reference-files" class="md-nav__link">
    <span class="md-ellipsis">
      📁 Reference Files
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../04-streaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    React Agents with Streaming Responses
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../reference/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../reference/adapters/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Adapters
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Adapters
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../reference/adapters/llm/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Llm
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_1_1" id="__nav_4_1_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_1">
            <span class="md-nav__icon md-icon"></span>
            Llm
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/adapters/llm/base_converter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Base converter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/adapters/llm/litellm_converter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Litellm converter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/adapters/llm/model_response_converter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Model response converter
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../reference/adapters/tools/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Tools
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_1_2" id="__nav_4_1_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_2">
            <span class="md-nav__icon md-icon"></span>
            Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/adapters/tools/composio_adapter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Composio adapter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/adapters/tools/langchain_adapter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Langchain adapter
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../reference/checkpointer/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Checkpointer
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Checkpointer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/checkpointer/base_checkpointer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Base checkpointer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/checkpointer/in_memory_checkpointer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    In memory checkpointer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/checkpointer/pg_checkpointer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pg checkpointer
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../reference/exceptions/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Exceptions
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Exceptions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/exceptions/graph_error/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Graph error
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/exceptions/node_error/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Node error
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/exceptions/recursion_error/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Recursion error
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/exceptions/storage_exceptions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Storage exceptions
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../reference/graph/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Graph
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Graph
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/graph/compiled_graph/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Compiled graph
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/graph/edge/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Edge
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/graph/node/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Node
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/graph/state_graph/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    State graph
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../reference/graph/tool_node/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Tool node
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_4_5" id="__nav_4_4_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4_5">
            <span class="md-nav__icon md-icon"></span>
            Tool node
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/graph/tool_node/base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Base
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/graph/tool_node/constants/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Constants
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/graph/tool_node/deps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deps
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/graph/tool_node/executors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Executors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/graph/tool_node/schema/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Schema
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../reference/graph/utils/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_4_6" id="__nav_4_4_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4_6">
            <span class="md-nav__icon md-icon"></span>
            Utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/graph/utils/handler_mixins/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Handler mixins
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/graph/utils/invoke_handler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Invoke handler
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/graph/utils/invoke_node_handler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Invoke node handler
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/graph/utils/stream_handler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Stream handler
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/graph/utils/stream_node_handler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Stream node handler
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/graph/utils/stream_utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Stream utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/graph/utils/utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../reference/prebuilt/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Prebuilt
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Prebuilt
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_5_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../reference/prebuilt/agent/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Agent
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_5_1" id="__nav_4_5_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5_1">
            <span class="md-nav__icon md-icon"></span>
            Agent
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/prebuilt/agent/branch_join/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Branch join
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/prebuilt/agent/deep_research/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deep research
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/prebuilt/agent/guarded/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Guarded
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/prebuilt/agent/map_reduce/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Map reduce
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/prebuilt/agent/network/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Network
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/prebuilt/agent/plan_act_reflect/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Plan act reflect
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/prebuilt/agent/rag/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Rag
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/prebuilt/agent/react/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    React
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/prebuilt/agent/router/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Router
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/prebuilt/agent/sequential/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Sequential
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/prebuilt/agent/supervisor_team/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Supervisor team
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/prebuilt/agent/swarm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Swarm
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../reference/publisher/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Publisher
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_6" id="__nav_4_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_6">
            <span class="md-nav__icon md-icon"></span>
            Publisher
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/publisher/base_publisher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Base publisher
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/publisher/console_publisher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Console publisher
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/publisher/events/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Events
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/publisher/kafka_publisher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kafka publisher
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/publisher/publish/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Publish
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/publisher/rabbitmq_publisher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Rabbitmq publisher
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/publisher/redis_publisher/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Redis publisher
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../reference/state/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    State
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_7" id="__nav_4_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            State
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/state/agent_state/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Agent state
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/state/base_context/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Base context
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/state/execution_state/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Execution state
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/state/message_context_manager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Message context manager
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../reference/store/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Store
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_8" id="__nav_4_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_8">
            <span class="md-nav__icon md-icon"></span>
            Store
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/store/base_store/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Base store
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/store/mem0_store/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mem0 store
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/store/qdrant_store/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Qdrant store
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/store/store_schema/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Store schema
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_8_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../reference/store/embedding/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Embedding
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_8_5" id="__nav_4_8_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_8_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_8_5">
            <span class="md-nav__icon md-icon"></span>
            Embedding
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/store/embedding/base_embedding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Base embedding
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/store/embedding/openai_embedding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Openai embedding
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_9" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../reference/utils/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_9" id="__nav_4_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_9">
            <span class="md-nav__icon md-icon"></span>
            Utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/utils/background_task_manager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Background task manager
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/utils/callable_utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Callable utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/utils/callbacks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Callbacks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/utils/command/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Command
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/utils/constants/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Constants
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/utils/converter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Converter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/utils/id_generator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Id generator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/utils/logging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Logging
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/utils/message/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Message
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/utils/metrics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metrics
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/utils/reducers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Reducers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/utils/thread_info/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Thread info
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../reference/utils/thread_name_generator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Thread name generator
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-objectives" class="md-nav__link">
    <span class="md-ellipsis">
      🎯 Learning Objectives
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#understanding-model-context-protocol" class="md-nav__link">
    <span class="md-ellipsis">
      🌐 Understanding Model Context Protocol
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🌐 Understanding Model Context Protocol">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-mcp" class="md-nav__link">
    <span class="md-ellipsis">
      What is MCP?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mcp-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      MCP Architecture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#benefits-of-mcp-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Benefits of MCP Integration
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mcp-components-in-pyagenity" class="md-nav__link">
    <span class="md-ellipsis">
      🏗️ MCP Components in PyAgenity
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🏗️ MCP Components in PyAgenity">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-mcp-client-setup" class="md-nav__link">
    <span class="md-ellipsis">
      1. MCP Client Setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-toolnode-with-mcp-integration" class="md-nav__link">
    <span class="md-ellipsis">
      2. ToolNode with MCP Integration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-mcp-enabled-react-agent" class="md-nav__link">
    <span class="md-ellipsis">
      3. MCP-Enabled React Agent
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-example-weather-agent-with-mcp" class="md-nav__link">
    <span class="md-ellipsis">
      🌤️ Complete Example: Weather Agent with MCP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🌤️ Complete Example: Weather Agent with MCP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-create-mcp-server" class="md-nav__link">
    <span class="md-ellipsis">
      Step 1: Create MCP Server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-2-create-mcp-client-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Step 2: Create MCP Client Configuration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-3-build-mcp-enabled-react-agent" class="md-nav__link">
    <span class="md-ellipsis">
      Step 3: Build MCP-Enabled React Agent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-run-the-mcp-agent" class="md-nav__link">
    <span class="md-ellipsis">
      Step 4: Run the MCP Agent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-5-running-the-complete-system" class="md-nav__link">
    <span class="md-ellipsis">
      Step 5: Running the Complete System
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-mcp-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      🔧 Advanced MCP Patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🔧 Advanced MCP Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#multi-server-mcp-client" class="md-nav__link">
    <span class="md-ellipsis">
      Multi-Server MCP Client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mcp-tool-discovery-and-filtering" class="md-nav__link">
    <span class="md-ellipsis">
      MCP Tool Discovery and Filtering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-handling-for-mcp-connections" class="md-nav__link">
    <span class="md-ellipsis">
      Error Handling for MCP Connections
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#building-custom-mcp-servers" class="md-nav__link">
    <span class="md-ellipsis">
      🏗️ Building Custom MCP Servers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🏗️ Building Custom MCP Servers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#database-mcp-server" class="md-nav__link">
    <span class="md-ellipsis">
      Database MCP Server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#file-system-mcp-server" class="md-nav__link">
    <span class="md-ellipsis">
      File System MCP Server
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debugging-mcp-integration" class="md-nav__link">
    <span class="md-ellipsis">
      🐛 Debugging MCP Integration
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🐛 Debugging MCP Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mcp-connection-testing" class="md-nav__link">
    <span class="md-ellipsis">
      MCP Connection Testing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mcp-tool-introspection" class="md-nav__link">
    <span class="md-ellipsis">
      MCP Tool Introspection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mcp-performance-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      MCP Performance Monitoring
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#production-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      ⚡ Production Best Practices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="⚡ Production Best Practices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-mcp-server-health-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      1. MCP Server Health Monitoring
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-mcp-tool-caching" class="md-nav__link">
    <span class="md-ellipsis">
      2. MCP Tool Caching
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-graceful-mcp-failover" class="md-nav__link">
    <span class="md-ellipsis">
      3. Graceful MCP Failover
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#next-steps" class="md-nav__link">
    <span class="md-ellipsis">
      🚀 Next Steps
    </span>
  </a>
  
    <nav class="md-nav" aria-label="🚀 Next Steps">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#advanced-mcp-topics" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced MCP Topics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reference-files" class="md-nav__link">
    <span class="md-ellipsis">
      📁 Reference Files
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="react-agents-with-model-context-protocol-mcp">React Agents with Model Context Protocol (MCP)<a class="headerlink" href="#react-agents-with-model-context-protocol-mcp" title="Permanent link">&para;</a></h1>
<p>The <strong>Model Context Protocol (MCP)</strong> is a standardized way to connect LLMs with external data sources and tools. PyAgenity provides seamless MCP integration, allowing your React agents to interact with databases, APIs, file systems, and custom services through a unified protocol.</p>
<h2 id="learning-objectives">🎯 Learning Objectives<a class="headerlink" href="#learning-objectives" title="Permanent link">&para;</a></h2>
<p>By the end of this tutorial, you'll understand:</p>
<ul>
<li>What MCP is and why it's important for agent development</li>
<li>How to integrate MCP servers with PyAgenity React agents</li>
<li>Building and consuming MCP tools in agent workflows</li>
<li>Creating custom MCP servers for domain-specific functionality</li>
<li>Debugging and monitoring MCP-enabled agents</li>
</ul>
<h2 id="understanding-model-context-protocol">🌐 Understanding Model Context Protocol<a class="headerlink" href="#understanding-model-context-protocol" title="Permanent link">&para;</a></h2>
<h3 id="what-is-mcp">What is MCP?<a class="headerlink" href="#what-is-mcp" title="Permanent link">&para;</a></h3>
<p>MCP is an open protocol that enables secure, standardized communication between AI applications and data sources. It provides:</p>
<ul>
<li><strong>Standardized Interface</strong>: Consistent API for different data sources</li>
<li><strong>Security</strong>: Built-in authentication and authorization</li>
<li><strong>Flexibility</strong>: Support for various transport mechanisms</li>
<li><strong>Extensibility</strong>: Easy to add new capabilities and data sources</li>
</ul>
<h3 id="mcp-architecture">MCP Architecture<a class="headerlink" href="#mcp-architecture" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code>React Agent ←→ PyAgenity ←→ MCP Client ←→ MCP Server ←→ External System
                                ↑              ↑
                          Protocol Layer   Data Source
</code></pre></div>
<h3 id="benefits-of-mcp-integration">Benefits of MCP Integration<a class="headerlink" href="#benefits-of-mcp-integration" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Protocol Standardization</strong>: No need to learn different APIs for each service</li>
<li><strong>Security</strong>: Built-in authentication and permission management  </li>
<li><strong>Scalability</strong>: Easy to add new data sources without agent changes</li>
<li><strong>Maintainability</strong>: Centralized tool management through MCP servers</li>
<li><strong>Interoperability</strong>: Works with any MCP-compliant system</li>
</ul>
<h2 id="mcp-components-in-pyagenity">🏗️ MCP Components in PyAgenity<a class="headerlink" href="#mcp-components-in-pyagenity" title="Permanent link">&para;</a></h2>
<h3 id="1-mcp-client-setup">1. MCP Client Setup<a class="headerlink" href="#1-mcp-client-setup" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">fastmcp</span><span class="w"> </span><span class="kn">import</span> <span class="n">Client</span>

<span class="c1"># MCP client configuration</span>
<span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;mcpServers&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;weather&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://127.0.0.1:8000/mcp&quot;</span><span class="p">,</span>
            <span class="s2">&quot;transport&quot;</span><span class="p">:</span> <span class="s2">&quot;streamable-http&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://db-service:8001/mcp&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;transport&quot;</span><span class="p">:</span> <span class="s2">&quot;streamable-http&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Create MCP client</span>
<span class="n">mcp_client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre></div>
<h3 id="2-toolnode-with-mcp-integration">2. ToolNode with MCP Integration<a class="headerlink" href="#2-toolnode-with-mcp-integration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">pyagenity.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">ToolNode</span>

<span class="c1"># ToolNode with MCP client (no custom functions needed)</span>
<span class="n">tool_node</span> <span class="o">=</span> <span class="n">ToolNode</span><span class="p">(</span><span class="n">functions</span><span class="o">=</span><span class="p">[],</span> <span class="n">client</span><span class="o">=</span><span class="n">mcp_client</span><span class="p">)</span>

<span class="c1"># PyAgenity automatically discovers and registers MCP tools</span>
</code></pre></div>
<h3 id="3-mcp-enabled-react-agent">3. MCP-Enabled React Agent<a class="headerlink" href="#3-mcp-enabled-react-agent" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">mcp_agent</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">AgentState</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelResponseConverter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;React agent with MCP tool integration.&quot;&quot;&quot;</span>

    <span class="n">system_prompt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    You are an intelligent assistant with access to various data sources</span>
<span class="s2">    through standardized tools. Use the available tools to help users</span>
<span class="s2">    with their requests.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">messages</span> <span class="o">=</span> <span class="n">convert_messages</span><span class="p">(</span>
        <span class="n">system_prompts</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">system_prompt</span><span class="p">}],</span>
        <span class="n">state</span><span class="o">=</span><span class="n">state</span>
    <span class="p">)</span>

    <span class="c1"># Get MCP tools dynamically</span>
    <span class="n">tools</span> <span class="o">=</span> <span class="k">await</span> <span class="n">tool_node</span><span class="o">.</span><span class="n">all_tools</span><span class="p">()</span>

    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">acompletion</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gemini/gemini-2.0-flash&quot;</span><span class="p">,</span>
        <span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">,</span>
        <span class="n">tools</span><span class="o">=</span><span class="n">tools</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">ModelResponseConverter</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">converter</span><span class="o">=</span><span class="s2">&quot;litellm&quot;</span><span class="p">)</span>
</code></pre></div>
<h2 id="complete-example-weather-agent-with-mcp">🌤️ Complete Example: Weather Agent with MCP<a class="headerlink" href="#complete-example-weather-agent-with-mcp" title="Permanent link">&para;</a></h2>
<p>Let's build a weather agent that uses MCP for tool integration:</p>
<h3 id="step-1-create-mcp-server">Step 1: Create MCP Server<a class="headerlink" href="#step-1-create-mcp-server" title="Permanent link">&para;</a></h3>
<p>First, create a simple MCP server that provides weather functionality:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># File: weather_mcp_server.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">fastmcp</span><span class="w"> </span><span class="kn">import</span> <span class="n">FastMCP</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">uvicorn</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>

<span class="c1"># Create MCP server</span>
<span class="n">mcp</span> <span class="o">=</span> <span class="n">FastMCP</span><span class="p">(</span><span class="s2">&quot;Weather Service&quot;</span><span class="p">)</span>

<span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_weather</span><span class="p">(</span><span class="n">location</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get current weather for a location.</span>

<span class="sd">    Args:</span>
<span class="sd">        location: City name or location to get weather for</span>

<span class="sd">    Returns:</span>
<span class="sd">        Current weather information</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># In production, call actual weather API</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Current weather in </span><span class="si">{</span><span class="n">location</span><span class="si">}</span><span class="s2">: Sunny, 24°C (75°F), light breeze&quot;</span>

<span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_forecast</span><span class="p">(</span><span class="n">location</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get weather forecast for multiple days.</span>

<span class="sd">    Args:</span>
<span class="sd">        location: City name or location</span>
<span class="sd">        days: Number of days to forecast (1-7)</span>

<span class="sd">    Returns:</span>
<span class="sd">        Multi-day weather forecast</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">days</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">:</span>
        <span class="n">days</span> <span class="o">=</span> <span class="mi">7</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">days</span><span class="si">}</span><span class="s2">-day forecast for </span><span class="si">{</span><span class="n">location</span><span class="si">}</span><span class="s2">: Mostly sunny with temperatures between 20-26°C&quot;</span>

<span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_weather_alerts</span><span class="p">(</span><span class="n">location</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get weather alerts and warnings for a location.</span>

<span class="sd">    Args:</span>
<span class="sd">        location: City name or location</span>

<span class="sd">    Returns:</span>
<span class="sd">        Active weather alerts, if any</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Mock implementation</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;No active weather alerts for </span><span class="si">{</span><span class="n">location</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="c1"># Additional server info</span>
<span class="nd">@mcp</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/health&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">health_check</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Health check endpoint.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;healthy&quot;</span><span class="p">,</span> <span class="s2">&quot;service&quot;</span><span class="p">:</span> <span class="s2">&quot;weather_mcp&quot;</span><span class="p">}</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting Weather MCP Server on http://127.0.0.1:8000&quot;</span><span class="p">)</span>
    <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">mcp</span><span class="o">.</span><span class="n">app</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8000</span><span class="p">)</span>
</code></pre></div>
<h3 id="step-2-create-mcp-client-configuration">Step 2: Create MCP Client Configuration<a class="headerlink" href="#step-2-create-mcp-client-configuration" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># File: mcp_config.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">fastmcp</span><span class="w"> </span><span class="kn">import</span> <span class="n">Client</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_mcp_client</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Client</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create and configure MCP client.&quot;&quot;&quot;</span>

    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;mcpServers&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;weather&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://127.0.0.1:8000/mcp&quot;</span><span class="p">,</span>
                <span class="s2">&quot;transport&quot;</span><span class="p">:</span> <span class="s2">&quot;streamable-http&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="c1"># Add more servers as needed</span>
            <span class="c1"># &quot;database&quot;: {</span>
            <span class="c1">#     &quot;url&quot;: &quot;http://127.0.0.1:8001/mcp&quot;,</span>
            <span class="c1">#     &quot;transport&quot;: &quot;streamable-http&quot;,</span>
            <span class="c1"># }</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">Client</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre></div>
<h3 id="step-3-build-mcp-enabled-react-agent">Step 3: Build MCP-Enabled React Agent<a class="headerlink" href="#step-3-build-mcp-enabled-react-agent" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># File: mcp_react_agent.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dotenv</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_dotenv</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">litellm</span><span class="w"> </span><span class="kn">import</span> <span class="n">acompletion</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">pyagenity.adapters.llm.model_response_converter</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModelResponseConverter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyagenity.checkpointer</span><span class="w"> </span><span class="kn">import</span> <span class="n">InMemoryCheckpointer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyagenity.graph</span><span class="w"> </span><span class="kn">import</span> <span class="n">StateGraph</span><span class="p">,</span> <span class="n">ToolNode</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyagenity.state.agent_state</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentState</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyagenity.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">Message</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyagenity.utils.constants</span><span class="w"> </span><span class="kn">import</span> <span class="n">END</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyagenity.utils.converter</span><span class="w"> </span><span class="kn">import</span> <span class="n">convert_messages</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mcp_config</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_mcp_client</span>

<span class="n">load_dotenv</span><span class="p">()</span>

<span class="c1"># Create MCP client and tool node</span>
<span class="n">mcp_client</span> <span class="o">=</span> <span class="n">create_mcp_client</span><span class="p">()</span>
<span class="n">tool_node</span> <span class="o">=</span> <span class="n">ToolNode</span><span class="p">(</span><span class="n">functions</span><span class="o">=</span><span class="p">[],</span> <span class="n">client</span><span class="o">=</span><span class="n">mcp_client</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">mcp_main_agent</span><span class="p">(</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">AgentState</span><span class="p">,</span>
    <span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">checkpointer</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">store</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelResponseConverter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main agent that uses MCP tools for weather information.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">system_prompt</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    You are a helpful weather assistant with access to comprehensive weather services.</span>

<span class="s2">    Available capabilities through MCP tools:</span>
<span class="s2">    - Current weather information for any location</span>
<span class="s2">    - Multi-day weather forecasts  </span>
<span class="s2">    - Weather alerts and warnings</span>

<span class="s2">    Guidelines:</span>
<span class="s2">    - Use appropriate tools based on user requests</span>
<span class="s2">    - Provide detailed, helpful weather information</span>
<span class="s2">    - If users ask for forecasts, use the forecast tool</span>
<span class="s2">    - Always check for weather alerts when relevant</span>
<span class="s2">    - Be conversational and friendly</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="n">messages</span> <span class="o">=</span> <span class="n">convert_messages</span><span class="p">(</span>
        <span class="n">system_prompts</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">system_prompt</span><span class="p">}],</span>
        <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Get available MCP tools</span>
    <span class="n">tools</span> <span class="o">=</span> <span class="k">await</span> <span class="n">tool_node</span><span class="o">.</span><span class="n">all_tools</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Available MCP tools: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tools</span><span class="p">)</span><span class="si">}</span><span class="s2"> tools discovered&quot;</span><span class="p">)</span>

    <span class="c1"># Log tool names for debugging</span>
    <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">tools</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;function&quot;</span> <span class="ow">in</span> <span class="n">tool</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">tool</span><span class="p">[</span><span class="s1">&#39;function&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Make LLM call with MCP tools</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">acompletion</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gemini/gemini-2.5-flash&quot;</span><span class="p">,</span>
        <span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">,</span>
        <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">ModelResponseConverter</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">converter</span><span class="o">=</span><span class="s2">&quot;litellm&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">should_use_mcp_tools</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">AgentState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Routing logic for MCP-enabled agent.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">state</span><span class="o">.</span><span class="n">context</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;TOOL&quot;</span>

    <span class="n">last_message</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># If assistant made tool calls, execute them via MCP</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">last_message</span><span class="p">,</span> <span class="s2">&quot;tools_calls&quot;</span><span class="p">)</span> <span class="ow">and</span> 
        <span class="n">last_message</span><span class="o">.</span><span class="n">tools_calls</span> <span class="ow">and</span> 
        <span class="nb">len</span><span class="p">(</span><span class="n">last_message</span><span class="o">.</span><span class="n">tools_calls</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span>
        <span class="n">last_message</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="s2">&quot;assistant&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;TOOL&quot;</span>

    <span class="c1"># If we got MCP tool results, return to main agent</span>
    <span class="k">if</span> <span class="n">last_message</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="s2">&quot;tool&quot;</span> <span class="ow">and</span> <span class="n">last_message</span><span class="o">.</span><span class="n">tool_call_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;MAIN&quot;</span>

    <span class="c1"># Default: conversation complete</span>
    <span class="k">return</span> <span class="n">END</span>

<span class="c1"># Build the graph</span>
<span class="n">graph</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">()</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;MAIN&quot;</span><span class="p">,</span> <span class="n">mcp_main_agent</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="s2">&quot;TOOL&quot;</span><span class="p">,</span> <span class="n">tool_node</span><span class="p">)</span>

<span class="n">graph</span><span class="o">.</span><span class="n">add_conditional_edges</span><span class="p">(</span><span class="s2">&quot;MAIN&quot;</span><span class="p">,</span> <span class="n">should_use_mcp_tools</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">&quot;TOOL&quot;</span><span class="p">:</span> <span class="s2">&quot;TOOL&quot;</span><span class="p">,</span> 
    <span class="n">END</span><span class="p">:</span> <span class="n">END</span>
<span class="p">})</span>

<span class="n">graph</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;TOOL&quot;</span><span class="p">,</span> <span class="s2">&quot;MAIN&quot;</span><span class="p">)</span>
<span class="n">graph</span><span class="o">.</span><span class="n">set_entry_point</span><span class="p">(</span><span class="s2">&quot;MAIN&quot;</span><span class="p">)</span>

<span class="c1"># Compile with checkpointer</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">checkpointer</span><span class="o">=</span><span class="n">InMemoryCheckpointer</span><span class="p">())</span>
</code></pre></div>
<h3 id="step-4-run-the-mcp-agent">Step 4: Run the MCP Agent<a class="headerlink" href="#step-4-run-the-mcp-agent" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># File: run_mcp_agent.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyagenity.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">Message</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">demo_mcp_agent</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate MCP-enabled weather agent.&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🌤️ MCP Weather Agent Demo&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>

    <span class="n">test_queries</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;What&#39;s the weather like in London today?&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Can you give me a 5-day forecast for New York?&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;Are there any weather alerts for Miami?&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Compare the weather in Tokyo and Sydney&quot;</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">query</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">test_queries</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">🔹 Query </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">40</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Prepare input</span>
            <span class="n">inp</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">Message</span><span class="o">.</span><span class="n">from_text</span><span class="p">(</span><span class="n">query</span><span class="p">)]}</span>
            <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;thread_id&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;mcp-demo-</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;recursion_limit&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>

            <span class="c1"># Run agent</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">)</span>

            <span class="c1"># Display conversation</span>
            <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;messages&quot;</span><span class="p">]:</span>
                <span class="n">role_emoji</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;👤&quot;</span><span class="p">,</span> 
                    <span class="s2">&quot;assistant&quot;</span><span class="p">:</span> <span class="s2">&quot;🤖&quot;</span><span class="p">,</span> 
                    <span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="s2">&quot;🔧&quot;</span>
                <span class="p">}</span>
                <span class="n">emoji</span> <span class="o">=</span> <span class="n">role_emoji</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">role</span><span class="p">,</span> <span class="s2">&quot;❓&quot;</span><span class="p">)</span>

                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">emoji</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">role</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">role</span> <span class="o">==</span> <span class="s2">&quot;tool&quot;</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   └─ Tool Call ID: </span><span class="si">{</span><span class="n">message</span><span class="o">.</span><span class="n">tool_call_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">demo_mcp_agent</span><span class="p">())</span>
</code></pre></div>
<h3 id="step-5-running-the-complete-system">Step 5: Running the Complete System<a class="headerlink" href="#step-5-running-the-complete-system" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Start the MCP server</strong>:
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>weather_mcp_server.py
</code></pre></div></p>
</li>
<li>
<p><strong>Run the agent</strong> (in another terminal):
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>run_mcp_agent.py
</code></pre></div></p>
</li>
</ol>
<h2 id="advanced-mcp-patterns">🔧 Advanced MCP Patterns<a class="headerlink" href="#advanced-mcp-patterns" title="Permanent link">&para;</a></h2>
<h3 id="multi-server-mcp-client">Multi-Server MCP Client<a class="headerlink" href="#multi-server-mcp-client" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_multi_server_client</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Client</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;MCP client with multiple server connections.&quot;&quot;&quot;</span>

    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;mcpServers&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="c1"># Weather service</span>
            <span class="s2">&quot;weather&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://weather-service:8000/mcp&quot;</span><span class="p">,</span>
                <span class="s2">&quot;transport&quot;</span><span class="p">:</span> <span class="s2">&quot;streamable-http&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="c1"># Database service</span>
            <span class="s2">&quot;database&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://db-service:8001/mcp&quot;</span><span class="p">,</span> 
                <span class="s2">&quot;transport&quot;</span><span class="p">:</span> <span class="s2">&quot;streamable-http&quot;</span><span class="p">,</span>
                <span class="s2">&quot;auth&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;bearer&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;token&quot;</span><span class="p">:</span> <span class="s2">&quot;your_db_token&quot;</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="c1"># File system service</span>
            <span class="s2">&quot;filesystem&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://fs-service:8002/mcp&quot;</span><span class="p">,</span>
                <span class="s2">&quot;transport&quot;</span><span class="p">:</span> <span class="s2">&quot;streamable-http&quot;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="c1"># Web search service</span>
            <span class="s2">&quot;search&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://search-service:8003/mcp&quot;</span><span class="p">,</span>
                <span class="s2">&quot;transport&quot;</span><span class="p">:</span> <span class="s2">&quot;streamable-http&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">Client</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</code></pre></div>
<h3 id="mcp-tool-discovery-and-filtering">MCP Tool Discovery and Filtering<a class="headerlink" href="#mcp-tool-discovery-and-filtering" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">filtered_mcp_agent</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">AgentState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelResponseConverter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Agent that filters MCP tools based on context.&quot;&quot;&quot;</span>

    <span class="c1"># Get all available MCP tools</span>
    <span class="n">all_tools</span> <span class="o">=</span> <span class="k">await</span> <span class="n">tool_node</span><span class="o">.</span><span class="n">all_tools</span><span class="p">()</span>

    <span class="c1"># Filter tools based on conversation context</span>
    <span class="n">filtered_tools</span> <span class="o">=</span> <span class="n">filter_tools_by_context</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">all_tools</span><span class="p">)</span>

    <span class="c1"># Use only relevant tools</span>
    <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">acompletion</span><span class="p">(</span>
        <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4&quot;</span><span class="p">,</span>
        <span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">,</span>
        <span class="n">tools</span><span class="o">=</span><span class="n">filtered_tools</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">ModelResponseConverter</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">converter</span><span class="o">=</span><span class="s2">&quot;litellm&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">filter_tools_by_context</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">AgentState</span><span class="p">,</span> <span class="n">tools</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter tools based on conversation context.&quot;&quot;&quot;</span>

    <span class="c1"># Extract context keywords</span>
    <span class="n">context_text</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">msg</span><span class="o">.</span><span class="n">content</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">context</span> <span class="ow">or</span> <span class="p">[]])</span>
    <span class="n">context_lower</span> <span class="o">=</span> <span class="n">context_text</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="n">filtered</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">tools</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;function&quot;</span> <span class="ow">in</span> <span class="n">tool</span><span class="p">:</span>
            <span class="n">tool_name</span> <span class="o">=</span> <span class="n">tool</span><span class="p">[</span><span class="s2">&quot;function&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="n">tool_desc</span> <span class="o">=</span> <span class="n">tool</span><span class="p">[</span><span class="s2">&quot;function&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

            <span class="c1"># Include weather tools if weather-related context</span>
            <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;weather&quot;</span> <span class="ow">in</span> <span class="n">context_lower</span> <span class="ow">or</span> <span class="s2">&quot;forecast&quot;</span> <span class="ow">in</span> <span class="n">context_lower</span><span class="p">):</span>
                <span class="k">if</span> <span class="s2">&quot;weather&quot;</span> <span class="ow">in</span> <span class="n">tool_name</span> <span class="ow">or</span> <span class="s2">&quot;forecast&quot;</span> <span class="ow">in</span> <span class="n">tool_name</span><span class="p">:</span>
                    <span class="n">filtered</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span>

            <span class="c1"># Include search tools if search-related context</span>
            <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;search&quot;</span> <span class="ow">in</span> <span class="n">context_lower</span> <span class="ow">or</span> <span class="s2">&quot;find&quot;</span> <span class="ow">in</span> <span class="n">context_lower</span><span class="p">):</span>
                <span class="k">if</span> <span class="s2">&quot;search&quot;</span> <span class="ow">in</span> <span class="n">tool_name</span> <span class="ow">or</span> <span class="s2">&quot;find&quot;</span> <span class="ow">in</span> <span class="n">tool_name</span><span class="p">:</span>
                    <span class="n">filtered</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span>

            <span class="c1"># Include database tools if data-related context</span>
            <span class="k">elif</span> <span class="p">(</span><span class="s2">&quot;data&quot;</span> <span class="ow">in</span> <span class="n">context_lower</span> <span class="ow">or</span> <span class="s2">&quot;query&quot;</span> <span class="ow">in</span> <span class="n">context_lower</span><span class="p">):</span>
                <span class="k">if</span> <span class="s2">&quot;query&quot;</span> <span class="ow">in</span> <span class="n">tool_name</span> <span class="ow">or</span> <span class="s2">&quot;database&quot;</span> <span class="ow">in</span> <span class="n">tool_name</span><span class="p">:</span>
                    <span class="n">filtered</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span>

            <span class="c1"># Default: include general tools</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;general&quot;</span> <span class="ow">in</span> <span class="n">tool_desc</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtered</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">filtered</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">filtered</span> <span class="ow">or</span> <span class="n">tools</span>  <span class="c1"># Return all tools if no matches</span>
</code></pre></div>
<h3 id="error-handling-for-mcp-connections">Error Handling for MCP Connections<a class="headerlink" href="#error-handling-for-mcp-connections" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">robust_mcp_agent</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">AgentState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelResponseConverter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;MCP agent with robust error handling.&quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Try to get MCP tools</span>
        <span class="n">tools</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span>
            <span class="n">tool_node</span><span class="o">.</span><span class="n">all_tools</span><span class="p">(),</span> 
            <span class="n">timeout</span><span class="o">=</span><span class="mf">5.0</span>  <span class="c1"># 5 second timeout</span>
        <span class="p">)</span>

        <span class="c1"># Check if tools are available</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tools</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">fallback_response</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s2">&quot;No tools available&quot;</span><span class="p">)</span>

        <span class="c1"># Normal operation with tools</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">acompletion</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4&quot;</span><span class="p">,</span>
            <span class="n">messages</span><span class="o">=</span><span class="n">messages</span><span class="p">,</span>
            <span class="n">tools</span><span class="o">=</span><span class="n">tools</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">ModelResponseConverter</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">converter</span><span class="o">=</span><span class="s2">&quot;litellm&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">fallback_response</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s2">&quot;Tool service timeout&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">ConnectionError</span><span class="p">:</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">fallback_response</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s2">&quot;Tool service unavailable&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MCP agent error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">fallback_response</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s2">&quot;Unexpected error&quot;</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fallback_response</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">AgentState</span><span class="p">,</span> <span class="n">error_reason</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Message</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Provide fallback response when MCP tools are unavailable.&quot;&quot;&quot;</span>

    <span class="n">fallback_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    I apologize, but I&#39;m currently experiencing technical difficulties </span>
<span class="s2">    with my tool services (</span><span class="si">{</span><span class="n">error_reason</span><span class="si">}</span><span class="s2">). I can still help with </span>
<span class="s2">    general questions that don&#39;t require real-time data.</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">Message</span><span class="o">.</span><span class="n">text_message</span><span class="p">(</span><span class="n">fallback_message</span><span class="p">)]</span>
</code></pre></div>
<h2 id="building-custom-mcp-servers">🏗️ Building Custom MCP Servers<a class="headerlink" href="#building-custom-mcp-servers" title="Permanent link">&para;</a></h2>
<h3 id="database-mcp-server">Database MCP Server<a class="headerlink" href="#database-mcp-server" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># File: database_mcp_server.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">fastmcp</span><span class="w"> </span><span class="kn">import</span> <span class="n">FastMCP</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="n">mcp</span> <span class="o">=</span> <span class="n">FastMCP</span><span class="p">(</span><span class="s2">&quot;Database Service&quot;</span><span class="p">)</span>

<span class="c1"># Initialize database</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;example.db&quot;</span><span class="p">)</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># Create sample tables</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    CREATE TABLE IF NOT EXISTS customers (</span>
<span class="s2">        id INTEGER PRIMARY KEY,</span>
<span class="s2">        name TEXT,</span>
<span class="s2">        email TEXT,</span>
<span class="s2">        city TEXT</span>
<span class="s2">    )</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    CREATE TABLE IF NOT EXISTS orders (</span>
<span class="s2">        id INTEGER PRIMARY KEY,</span>
<span class="s2">        customer_id INTEGER,</span>
<span class="s2">        product TEXT,</span>
<span class="s2">        amount REAL,</span>
<span class="s2">        order_date TEXT</span>
<span class="s2">    )</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="c1"># Insert sample data</span>
<span class="n">sample_customers</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;John Doe&quot;</span><span class="p">,</span> <span class="s2">&quot;john@example.com&quot;</span><span class="p">,</span> <span class="s2">&quot;New York&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Jane Smith&quot;</span><span class="p">,</span> <span class="s2">&quot;jane@example.com&quot;</span><span class="p">,</span> <span class="s2">&quot;London&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;Bob Johnson&quot;</span><span class="p">,</span> <span class="s2">&quot;bob@example.com&quot;</span><span class="p">,</span> <span class="s2">&quot;Tokyo&quot;</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="s2">&quot;INSERT OR REPLACE INTO customers VALUES (?, ?, ?, ?)&quot;</span><span class="p">,</span> <span class="n">sample_customers</span><span class="p">)</span>
<span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

<span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">query_customers</span><span class="p">(</span><span class="n">city</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Query customers from database.</span>

<span class="sd">    Args:</span>
<span class="sd">        city: Optional city filter</span>

<span class="sd">    Returns:</span>
<span class="sd">        JSON list of customers</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">city</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM customers WHERE city = ?&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">city</span><span class="p">,))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM customers&quot;</span><span class="p">)</span>

        <span class="n">customers</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

        <span class="c1"># Convert to dict format</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">customer</span> <span class="ow">in</span> <span class="n">customers</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">customer</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">customer</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
                <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">customer</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="s2">&quot;city&quot;</span><span class="p">:</span> <span class="n">customer</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="p">})</span>

        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Database error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add_customer</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">city</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a new customer to the database.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: Customer name</span>
<span class="sd">        email: Customer email</span>
<span class="sd">        city: Customer city</span>

<span class="sd">    Returns:</span>
<span class="sd">        Success message with customer ID</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;INSERT INTO customers (name, email, city) VALUES (?, ?, ?)&quot;</span><span class="p">,</span>
            <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">city</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="n">customer_id</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">lastrowid</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Customer added successfully with ID: </span><span class="si">{</span><span class="n">customer_id</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error adding customer: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_customer_stats</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get customer statistics.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Statistics about customers in the database</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Total customers</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT COUNT(*) FROM customers&quot;</span><span class="p">)</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Customers by city</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT city, COUNT(*) FROM customers GROUP BY city&quot;</span><span class="p">)</span>
        <span class="n">by_city</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

        <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;total_customers&quot;</span><span class="p">:</span> <span class="n">total</span><span class="p">,</span>
            <span class="s2">&quot;customers_by_city&quot;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">by_city</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error getting stats: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">uvicorn</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting Database MCP Server on http://127.0.0.1:8001&quot;</span><span class="p">)</span>
    <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">mcp</span><span class="o">.</span><span class="n">app</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8001</span><span class="p">)</span>
</code></pre></div>
<h3 id="file-system-mcp-server">File System MCP Server<a class="headerlink" href="#file-system-mcp-server" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># File: filesystem_mcp_server.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">fastmcp</span><span class="w"> </span><span class="kn">import</span> <span class="n">FastMCP</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="n">mcp</span> <span class="o">=</span> <span class="n">FastMCP</span><span class="p">(</span><span class="s2">&quot;File System Service&quot;</span><span class="p">)</span>

<span class="c1"># Define safe sandbox directory</span>
<span class="n">SANDBOX_DIR</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;./sandbox&quot;</span><span class="p">)</span>
<span class="n">SANDBOX_DIR</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">safe_path</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Ensure file operations stay within sandbox.&quot;&quot;&quot;</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">SANDBOX_DIR</span> <span class="o">/</span> <span class="n">filename</span>
    <span class="c1"># Resolve to absolute path and check it&#39;s within sandbox</span>
    <span class="n">abs_path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
    <span class="n">abs_sandbox</span> <span class="o">=</span> <span class="n">SANDBOX_DIR</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">abs_path</span><span class="o">.</span><span class="n">is_relative_to</span><span class="p">(</span><span class="n">abs_sandbox</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Path outside sandbox: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">abs_path</span>

<span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">read_file</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read contents of a file from the sandbox directory.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename: Name of file to read</span>

<span class="sd">    Returns:</span>
<span class="sd">        File contents or error message</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">safe_path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;File not found: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Content of </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">:</span><span class="se">\n\n</span><span class="si">{</span><span class="n">content</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error reading file: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">write_file</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write content to a file in the sandbox directory.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename: Name of file to write</span>
<span class="sd">        content: Content to write to the file</span>

<span class="sd">    Returns:</span>
<span class="sd">        Success message or error</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">safe_path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1"># Create parent directories if needed</span>
        <span class="n">path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Successfully wrote </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="si">}</span><span class="s2"> characters to </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error writing file: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
<span class="k">def</span><span class="w"> </span><span class="nf">list_files</span><span class="p">(</span><span class="n">directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    List files in a directory within the sandbox.</span>

<span class="sd">    Args:</span>
<span class="sd">        directory: Directory to list (relative to sandbox)</span>

<span class="sd">    Returns:</span>
<span class="sd">        JSON list of files and directories</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">safe_path</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Directory not found: </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Not a directory: </span><span class="si">{</span><span class="n">directory</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">():</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;directory&quot;</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;file&quot;</span><span class="p">,</span>
                <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="p">})</span>

        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error listing directory: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">uvicorn</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting File System MCP Server on http://127.0.0.1:8002&quot;</span><span class="p">)</span>
    <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">mcp</span><span class="o">.</span><span class="n">app</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8002</span><span class="p">)</span>
</code></pre></div>
<h2 id="debugging-mcp-integration">🐛 Debugging MCP Integration<a class="headerlink" href="#debugging-mcp-integration" title="Permanent link">&para;</a></h2>
<h3 id="mcp-connection-testing">MCP Connection Testing<a class="headerlink" href="#mcp-connection-testing" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_mcp_connection</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Test MCP server connections.&quot;&quot;&quot;</span>

    <span class="n">client</span> <span class="o">=</span> <span class="n">create_mcp_client</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Create test tool node</span>
        <span class="n">test_tool_node</span> <span class="o">=</span> <span class="n">ToolNode</span><span class="p">(</span><span class="n">functions</span><span class="o">=</span><span class="p">[],</span> <span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>

        <span class="c1"># Test tool discovery</span>
        <span class="n">tools</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span>
            <span class="n">test_tool_node</span><span class="o">.</span><span class="n">all_tools</span><span class="p">(),</span>
            <span class="n">timeout</span><span class="o">=</span><span class="mf">10.0</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;✅ MCP Connection successful - </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tools</span><span class="p">)</span><span class="si">}</span><span class="s2"> tools available&quot;</span><span class="p">)</span>

        <span class="c1"># List discovered tools</span>
        <span class="k">for</span> <span class="n">tool</span> <span class="ow">in</span> <span class="n">tools</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;function&quot;</span> <span class="ow">in</span> <span class="n">tool</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">tool</span><span class="p">[</span><span class="s2">&quot;function&quot;</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="n">tool</span><span class="p">[</span><span class="s2">&quot;function&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;No description&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  🔧 </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">desc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;❌ MCP Connection timeout&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ MCP Connection error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="c1"># Run connection test</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">test_mcp_connection</span><span class="p">())</span>
</code></pre></div>
<h3 id="mcp-tool-introspection">MCP Tool Introspection<a class="headerlink" href="#mcp-tool-introspection" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">inspect_mcp_tools</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detailed inspection of MCP tools.&quot;&quot;&quot;</span>

    <span class="n">tool_node</span> <span class="o">=</span> <span class="n">ToolNode</span><span class="p">(</span><span class="n">functions</span><span class="o">=</span><span class="p">[],</span> <span class="n">client</span><span class="o">=</span><span class="n">create_mcp_client</span><span class="p">())</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">tools</span> <span class="o">=</span> <span class="k">await</span> <span class="n">tool_node</span><span class="o">.</span><span class="n">all_tools</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;🔍 MCP Tool Inspection Report&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">tool</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tools</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">📋 Tool </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="c1"># Function details</span>
                <span class="k">if</span> <span class="s2">&quot;function&quot;</span> <span class="ow">in</span> <span class="n">tool</span><span class="p">:</span>
                    <span class="n">func</span> <span class="o">=</span> <span class="n">tool</span><span class="p">[</span><span class="s2">&quot;function&quot;</span><span class="p">]</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Name: </span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Description: </span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;description&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;No description&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># Parameters</span>
                    <span class="k">if</span> <span class="s2">&quot;parameters&quot;</span> <span class="ow">in</span> <span class="n">func</span><span class="p">:</span>
                        <span class="n">params</span> <span class="o">=</span> <span class="n">func</span><span class="p">[</span><span class="s2">&quot;parameters&quot;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="s2">&quot;properties&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  Parameters:&quot;</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param_info</span> <span class="ow">in</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;properties&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                <span class="n">param_type</span> <span class="o">=</span> <span class="n">param_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
                                <span class="n">param_desc</span> <span class="o">=</span> <span class="n">param_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="s2">&quot;No description&quot;</span><span class="p">)</span>
                                <span class="n">required</span> <span class="o">=</span> <span class="n">param_name</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="p">[])</span>
                                <span class="n">req_str</span> <span class="o">=</span> <span class="s2">&quot; (required)&quot;</span> <span class="k">if</span> <span class="n">required</span> <span class="k">else</span> <span class="s2">&quot; (optional)&quot;</span>
                                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    - </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">param_type</span><span class="si">}{</span><span class="n">req_str</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">param_desc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="c1"># Raw tool data</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Raw data: </span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span><span class="w"> </span><span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Unexpected tool format: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;❌ Tool inspection error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Run inspection</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">inspect_mcp_tools</span><span class="p">())</span>
</code></pre></div>
<h3 id="mcp-performance-monitoring">MCP Performance Monitoring<a class="headerlink" href="#mcp-performance-monitoring" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ToolCallMetrics</span><span class="p">:</span>
    <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">duration_ms</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">float</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MCPMetricsCollector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Collect and analyze MCP tool performance metrics.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ToolCallMetrics</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">record_call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">duration_ms</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Record a tool call metric.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ToolCallMetrics</span><span class="p">(</span>
            <span class="n">tool_name</span><span class="o">=</span><span class="n">tool_name</span><span class="p">,</span>
            <span class="n">duration_ms</span><span class="o">=</span><span class="n">duration_ms</span><span class="p">,</span> 
            <span class="n">success</span><span class="o">=</span><span class="n">success</span><span class="p">,</span>
            <span class="n">timestamp</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get performance statistics.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;No metrics available&quot;</span><span class="p">}</span>

        <span class="c1"># Group by tool name</span>
        <span class="n">by_tool</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">metric</span><span class="o">.</span><span class="n">tool_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">by_tool</span><span class="p">:</span>
                <span class="n">by_tool</span><span class="p">[</span><span class="n">metric</span><span class="o">.</span><span class="n">tool_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">by_tool</span><span class="p">[</span><span class="n">metric</span><span class="o">.</span><span class="n">tool_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span>

        <span class="c1"># Calculate stats</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">tool_name</span><span class="p">,</span> <span class="n">tool_metrics</span> <span class="ow">in</span> <span class="n">by_tool</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">durations</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">duration_ms</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">tool_metrics</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">success</span><span class="p">]</span>
            <span class="n">success_rate</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">tool_metrics</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">success</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">tool_metrics</span><span class="p">)</span>

            <span class="n">stats</span><span class="p">[</span><span class="n">tool_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;total_calls&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">tool_metrics</span><span class="p">),</span>
                <span class="s2">&quot;success_rate&quot;</span><span class="p">:</span> <span class="n">success_rate</span><span class="p">,</span>
                <span class="s2">&quot;avg_duration_ms&quot;</span><span class="p">:</span> <span class="nb">sum</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span> <span class="k">if</span> <span class="n">durations</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;min_duration_ms&quot;</span><span class="p">:</span> <span class="nb">min</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span> <span class="k">if</span> <span class="n">durations</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s2">&quot;max_duration_ms&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span> <span class="k">if</span> <span class="n">durations</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="n">stats</span>

<span class="c1"># Global metrics collector</span>
<span class="n">mcp_metrics</span> <span class="o">=</span> <span class="n">MCPMetricsCollector</span><span class="p">()</span>

<span class="c1"># Wrap tool calls with metrics</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">monitored_tool_execution</span><span class="p">(</span><span class="n">tool_node</span><span class="p">:</span> <span class="n">ToolNode</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">AgentState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Message</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute tools with performance monitoring.&quot;&quot;&quot;</span>

    <span class="n">last_message</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">tool_calls</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">last_message</span><span class="p">,</span> <span class="s2">&quot;tools_calls&quot;</span><span class="p">,</span> <span class="p">[])</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">tool_call</span> <span class="ow">in</span> <span class="n">tool_calls</span><span class="p">:</span>
        <span class="n">tool_name</span> <span class="o">=</span> <span class="n">tool_call</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Execute the tool call</span>
            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">tool_node</span><span class="o">.</span><span class="n">execute_tool_call</span><span class="p">(</span><span class="n">tool_call</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

            <span class="c1"># Record success</span>
            <span class="n">duration_ms</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="n">mcp_metrics</span><span class="o">.</span><span class="n">record_call</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="n">duration_ms</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Record failure</span>
            <span class="n">duration_ms</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="n">mcp_metrics</span><span class="o">.</span><span class="n">record_call</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="n">duration_ms</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Create error message</span>
            <span class="n">error_result</span> <span class="o">=</span> <span class="n">Message</span><span class="o">.</span><span class="n">tool_message</span><span class="p">(</span>
                <span class="n">content</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Tool execution failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">tool_call_id</span><span class="o">=</span><span class="n">tool_call</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tool_call_id&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_result</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div>
<h2 id="production-best-practices">⚡ Production Best Practices<a class="headerlink" href="#production-best-practices" title="Permanent link">&para;</a></h2>
<h3 id="1-mcp-server-health-monitoring">1. MCP Server Health Monitoring<a class="headerlink" href="#1-mcp-server-health-monitoring" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">aiohttp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>

<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">monitor_mcp_servers</span><span class="p">(</span><span class="n">config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Monitor health of MCP servers.&quot;&quot;&quot;</span>

    <span class="n">health_status</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">async</span> <span class="k">with</span> <span class="n">aiohttp</span><span class="o">.</span><span class="n">ClientSession</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">server_name</span><span class="p">,</span> <span class="n">server_config</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;mcpServers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Check server health endpoint</span>
                <span class="n">url</span> <span class="o">=</span> <span class="n">server_config</span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/mcp&quot;</span><span class="p">,</span> <span class="s2">&quot;/health&quot;</span><span class="p">)</span>

                <span class="k">async</span> <span class="k">with</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                        <span class="n">health_status</span><span class="p">[</span><span class="n">server_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;healthy&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;response_time_ms&quot;</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;X-Response-Time&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
                        <span class="p">}</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">health_status</span><span class="p">[</span><span class="n">server_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;unhealthy&quot;</span><span class="p">,</span> 
                            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;HTTP </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">}</span>

            <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
                <span class="n">health_status</span><span class="p">[</span><span class="n">server_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;timeout&quot;</span><span class="p">}</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">health_status</span><span class="p">[</span><span class="n">server_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>

    <span class="k">return</span> <span class="n">health_status</span>
</code></pre></div>
<h3 id="2-mcp-tool-caching">2. MCP Tool Caching<a class="headerlink" href="#2-mcp-tool-caching" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">lru_cache</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CachedMCPToolNode</span><span class="p">(</span><span class="n">ToolNode</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ToolNode with tool discovery caching.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">cache_ttl</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cache_ttl</span> <span class="o">=</span> <span class="n">cache_ttl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache_time</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">all_tools</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get tools with caching.&quot;&quot;&quot;</span>

        <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Check cache validity</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">current_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_time</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cache_ttl</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;tools&quot;</span><span class="p">]</span>

        <span class="c1"># Refresh cache</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tools</span> <span class="o">=</span> <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">all_tools</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;tools&quot;</span><span class="p">:</span> <span class="n">tools</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache_time</span> <span class="o">=</span> <span class="n">current_time</span>
            <span class="k">return</span> <span class="n">tools</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Return cached tools if available, otherwise raise</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: Using cached tools due to error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="s2">&quot;tools&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span>
</code></pre></div>
<h3 id="3-graceful-mcp-failover">3. Graceful MCP Failover<a class="headerlink" href="#3-graceful-mcp-failover" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_resilient_mcp_agent</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">StateGraph</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create MCP agent with failover capabilities.&quot;&quot;&quot;</span>

    <span class="c1"># Primary MCP configuration</span>
    <span class="n">primary_config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;mcpServers&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;weather&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://primary-weather:8000/mcp&quot;</span><span class="p">,</span> <span class="s2">&quot;transport&quot;</span><span class="p">:</span> <span class="s2">&quot;streamable-http&quot;</span><span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1"># Fallback MCP configuration</span>
    <span class="n">fallback_config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;mcpServers&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;weather&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="s2">&quot;http://fallback-weather:8000/mcp&quot;</span><span class="p">,</span> <span class="s2">&quot;transport&quot;</span><span class="p">:</span> <span class="s2">&quot;streamable-http&quot;</span><span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1"># Create clients</span>
    <span class="n">primary_client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">primary_config</span><span class="p">)</span>
    <span class="n">fallback_client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">fallback_config</span><span class="p">)</span>

    <span class="c1"># Create tool nodes</span>
    <span class="n">primary_tool_node</span> <span class="o">=</span> <span class="n">ToolNode</span><span class="p">(</span><span class="n">functions</span><span class="o">=</span><span class="p">[],</span> <span class="n">client</span><span class="o">=</span><span class="n">primary_client</span><span class="p">)</span>
    <span class="n">fallback_tool_node</span> <span class="o">=</span> <span class="n">ToolNode</span><span class="p">(</span><span class="n">functions</span><span class="o">=</span><span class="p">[],</span> <span class="n">client</span><span class="o">=</span><span class="n">fallback_client</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">resilient_agent</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">AgentState</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ModelResponseConverter</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Agent that fails over between MCP servers.&quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Try primary MCP server</span>
            <span class="n">tools</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span>
                <span class="n">primary_tool_node</span><span class="o">.</span><span class="n">all_tools</span><span class="p">(),</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mf">5.0</span>
            <span class="p">)</span>
            <span class="n">active_tool_node</span> <span class="o">=</span> <span class="n">primary_tool_node</span>

        <span class="k">except</span> <span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">,</span> <span class="ne">ConnectionError</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Primary MCP server unavailable, using fallback&quot;</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">tools</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span>
                    <span class="n">fallback_tool_node</span><span class="o">.</span><span class="n">all_tools</span><span class="p">(),</span>
                    <span class="n">timeout</span><span class="o">=</span><span class="mf">5.0</span>
                <span class="p">)</span>
                <span class="n">active_tool_node</span> <span class="o">=</span> <span class="n">fallback_tool_node</span>

            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All MCP servers unavailable, using local tools only&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="k">await</span> <span class="n">local_agent_fallback</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

        <span class="c1"># Use available MCP tools</span>
        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">acompletion</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="s2">&quot;gpt-4&quot;</span><span class="p">,</span>
            <span class="n">messages</span><span class="o">=</span><span class="n">convert_messages</span><span class="p">(</span><span class="n">system_prompts</span><span class="o">=</span><span class="p">[</span><span class="o">...</span><span class="p">],</span> <span class="n">state</span><span class="o">=</span><span class="n">state</span><span class="p">),</span>
            <span class="n">tools</span><span class="o">=</span><span class="n">tools</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">ModelResponseConverter</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">converter</span><span class="o">=</span><span class="s2">&quot;litellm&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">resilient_agent</span>
</code></pre></div>
<h2 id="next-steps">🚀 Next Steps<a class="headerlink" href="#next-steps" title="Permanent link">&para;</a></h2>
<p>Excellent! You now understand how to integrate MCP with PyAgenity React agents. Here's what to explore next:</p>
<ol>
<li><strong><a href="../04-streaming/">Streaming Responses</a></strong> - Real-time agent responses with event streaming</li>
<li><strong>Advanced MCP Servers</strong> - Building production-grade MCP services</li>
<li><strong>Multi-Agent MCP</strong> - Coordinating multiple agents with shared MCP resources</li>
</ol>
<h3 id="advanced-mcp-topics">Advanced MCP Topics<a class="headerlink" href="#advanced-mcp-topics" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>MCP Authentication</strong>: Secure server connections and authorization</li>
<li><strong>MCP Federation</strong>: Connecting multiple MCP server networks</li>
<li><strong>Custom Transports</strong>: Building specialized MCP communication layers  </li>
<li><strong>MCP Monitoring</strong>: Production monitoring and observability</li>
</ul>
<h2 id="reference-files">📁 Reference Files<a class="headerlink" href="#reference-files" title="Permanent link">&para;</a></h2>
<p>Study these MCP examples:</p>
<ul>
<li><code>examples/react-mcp/react-mcp.py</code> - Basic MCP integration with PyAgenity</li>
<li><code>examples/react-mcp/server.py</code> - Simple MCP server implementation  </li>
<li><code>examples/react-mcp/client.py</code> - Standalone MCP client testing</li>
</ul>
<p>MCP integration opens up unlimited possibilities for your React agents. With standardized protocol integration, you can easily connect to any data source or service while maintaining clean, maintainable agent code!</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.pagination", "navigation.goto_top", "navigation.path", "navigation.tabs", "navigation.top", "search-suggest", "search.highlight", "search.share", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>